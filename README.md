![집밥도감](https://github.com/user-attachments/assets/3db90d63-ebbd-498e-b3aa-fc0dfba54d3c)
<h1>집밥연구소의 집밥도감 📖🍳</h1>

### 💫 요리를 하고싶지만 방법을 모르는 요리 초보 사용자들을 위한 레시피 안내 서비스 💫<br/>
<div> ➡️초보자들이 쉽게 요리를 배울 수 있도록 게이미피케이션 요소를 도입한 레시피 제공 서비스입니다. 인기/추천 레시피부터 냉장고 재료 활용 레시피까지 다양한 요리를 재미있게 탐험할 수 있습니다. 로그인, 스크랩, 마이페이지 등 사용자 맞춤 기능도 포함된 웹앱입니다.</div> <br/>

![브로셔](https://github.com/user-attachments/assets/faf35f23-d2a2-4ba6-896e-b3cac49069a2)


#### 🕓 작업 기간 : 24.10.18 ~ 24.11.20
#### 🔗 배포 링크 : [집밥도감 바로가기](https://zipbob-dex.vercel.app/)
<br/>

## 🫂 팀 소개

| | 김하영 | 신한별 | 선채훈 | 이정곤 |
| :-------------: | :-------------: | :-------------: | :-------------: | :-------------: |
| 역할 | 팀장 | 부팀장 | 팀원 | 팀원 |
| Github | <a href=https://github.com/duddlfkd02> @duddlfkd02 </a> | <a href=https://github.com/star1024cd> @star1024cd </a> | <a href=https://github.com/slppills> @slppills </a> | <a href=https://github.com/jeongol> @jeongol </a> |
| Blog | <a href=https://velog.io/@duddlfkd02> <img src="https://img.shields.io/badge/Velog-20C997?style=for-the-badge&logo=Velog&logoColor=white&link=https://velog.io/@rooftop7788"> </a> | <a href=https://velog.io/@star1024> <img src="https://img.shields.io/badge/Velog-20C997?style=for-the-badge&logo=Velog&logoColor=white&link=https://velog.io/@hbeom00"> </a> | <a href=https://velog.io/@slppills> <img src="https://img.shields.io/badge/Velog-20C997?style=for-the-badge&logo=Velog&logoColor=white&link=https://velog.io/@slppills"> </a> | <a href=https://velog.io/@jgoncode/posts> <img src="https://img.shields.io/badge/Velog-20C997?style=for-the-badge&logo=Velog&logoColor=white&link=https://velog.io/@rooftop7788"> </a> |
<br/>

## 🛠️ 기술 스택
**코드 컨벤션**
<div>
<img src="https://img.shields.io/badge/Prettier-F7B93E?style=for-the-badge&logo=Prettier&logoColor=white">
<img src="https://img.shields.io/badge/Eslint-4B32C3?style=for-the-badge&logo=Eslint&logoColor=white">
</div>
<br/>

**프레임워크 && 라이브러리**
<div>
<img src="https://img.shields.io/badge/Next.js-000000?style=for-the-badge&logo=Next.js&logoColor=white">
<img src="https://img.shields.io/badge/TypeScript-007ACC?style=for-the-badge&logo=typescript&logoColor=white">
<img src="https://img.shields.io/badge/Tailwind CSS-06B6D4?style=for-the-badge&logo=Tailwind CSS&logoColor=white">
 <img src="https://img.shields.io/badge/React Hook Form-EC5990?style=for-the-badge&logo=React-Hook-Form&logoColor=white">
<img src="https://img.shields.io/badge/Zod-3E67B1?style=for-the-badge&logo=zod&logoColor=white">
</div>
<br/>

**상태관리**
<div>
<img src="https://img.shields.io/badge/zustand-orange?style=for-the-badge&logo=zustand&logoColor=white">
 <img src="https://img.shields.io/badge/Tanstack Query-FF4154?style=for-the-badge&logo=ReactQuery&logoColor=white">
</div>
<br/>

**데이터베이스**
<div><img src="https://img.shields.io/badge/Supabase-black?style=for-the-badge&logo=supabase&logoColor=3ECF8E"></div>
<br/>

## 📚 페이지 설명
<details>
<summary>메인페이지</summary>
 
 ![메인페이지](https://github.com/user-attachments/assets/f40b64ff-619b-49ec-a4f8-2e91ea206bd6)
</details>

<details>
<summary>로그인/회원가입 페이지</summary>
 
 ![로그인/회원가입 페이지](https://github.com/user-attachments/assets/6a1e6698-3ce9-4a73-a6a3-2667bc9f2222)
</details>

<details>
<summary>냉장고 탐험 페이지</summary>
 
 ![냉장고 탐험 페이지](https://github.com/user-attachments/assets/e01edba3-3ab9-468a-a305-721d65044c16)
</details>

<details>
<summary>레시피 상세 페이지</summary>
 
![레시피 상세 페이지](https://github.com/user-attachments/assets/ff3f57a8-3ace-49bd-a567-38abbefd716f)
</details>

<details>
<summary>마이페이지</summary>
 
 ![마이페이지](https://github.com/user-attachments/assets/a05acda0-d8f6-4d37-9e79-d52ffafb9913)
</details>

<details>
<summary>스크랩 페이지</summary>
 
![스크랩 페이지](https://github.com/user-attachments/assets/5d57d330-845a-4b1f-b817-fbaa6270d7ae)
</details>

<details>
<summary>나만의 레시피 등록 페이지</summary>
 
 ![나만의 레시피 등록 페이지](https://github.com/user-attachments/assets/c247db01-8a43-4fe2-9c8c-9cf71951cd49)
</details>
<br/>

## 🔎 역할
<details>
<summary>김하영</summary>
 
 - 마이페이지, 스크랩 페이지
   - 자신이 쓴 글이나 댓글을 달았던 레시피 확인
   - 레시피를 스크랩버튼을 눌러 저장할 수 있음
</details>

<details>
<summary>신한별</summary>
 
 - 레시피 작성 페이지, 상세페이지, 좋아요 기능 
   - 레시피 작성 페이지에서 자신만의 레시피를 등록할 수 있음
   - 상세페이지에서 레시피 상세 내용과 댓글을 확인/등록할 수 있음
</details>

<details>
<summary>선채훈</summary>
 
 - 로그인/회원가입 페이지, 메인페이지
   - supabase를 이용한 소셜로그인, 일반로그인 기능
   - 메인페이지(헤더, 푸터) 제작
</details>

<details>
<summary>이정곤</summary>
 
 - 검색 결과 페이지, 냉장고 탐험 페이지
   - 레시피 메뉴나 재료 검색 기능
   - 있는 재료와 없는 재료를 검색해서 레시피 찾기 기능
</details>
<br/>

## ⛓️ 아키텍쳐
![아키텍처](https://github.com/user-attachments/assets/e7165c68-afb3-46e9-8da2-cdd6cbdd2815)

<br/>

## 🔐 ER 다이어그램
![image](https://github.com/user-attachments/assets/7bc0c5d5-a1eb-41bd-9fbb-7c6d252af075)

<br/>

## 💥 트러블슈팅
<details>
<summary style="font-size: 1.5rem;">TypeScript import 로컬 값 충돌🍥</summary>
 
### 원인찾기 👩🏻‍💻

평소처럼 타입스크립트를 별도 파일애 정리하고 `import` 해서 사용하려고 했는데 다음과 같은 에러 화면이 나왔다.

<img width="842" alt="스크린샷 2024-11-10 오후 5 22 23" src="https://github.com/user-attachments/assets/b0615909-33a1-4122-934d-c3f8c6714b8c">

```jsx
// UserCommment 컴포넌트
import type { UserComment } from "@/types/MyPage";

// MyPage.ts (타입스크립트 모음)
export interface UserComment {
  post_id: string;
  comment: string;
  created_at: string;
  recipe?: {
    recipe_title: string;
    recipe_img_done: string;
    recipe_level: string;
  } | null;
}

export interface UserPost {
  post_id: string;
  recipe_title: string;
  recipe_img_done: string;
  recipe_level: string;
  user: {
    user_id: string;
    user_nickname: string;
    user_img: string;
    user_introduce: string;
    user_rank: number;
  };
}

```

### isolatedModules 옵션이 뭘까? 🤔

구글링 결과 이는 `compilerOptions` 중 하나로 관련된 옵션은 정말 많았다.

### **💡compilerOptions** ?

만들어진 타입스크립트의 코드를 자바스크립트로 변환하기 위해 작성하는 옵션

이것 중에서 내가 만난 에러는 기본 옵션 중 "`isolatedModules`" 이었고 이는 **각 파일을 별도 모듈로 변환**하는 옵션이다. 

```jsx
"isolatedModules": true, /* 각 파일을 별도 모듈로 변환 ('ts.transpileModule'과 유사) */
```

이 옵션이 활성화 된 경우, 가져온 타입을 일반 `import` 가 아니라 `“형식 전용 가져오기”` 를 사용해야 한다는 것을 의미한다.

`true`로 설정되어 있다면 **타입스크립트는 모든 import 문을 모듈로 취급**하기 때문에 실제 값이 아닌 “타입만을 가져오려는 경우” 이런 오류가 발생할 수 있다.

### 문제해결 ✅

따라서 이 오류를 해결하려면 **형식 전용 가져오기**를 사용하여 명시해주면 된다.
```jsx
// 일반 import 대신 type 전용 import 사용
import type { UserComment} from "@/types/MyPage";
```
</details>

<details>
<summary>React-Hook-Form 에서의 ref 사용 ✨</summary>
 
### 원인찾기 👩🏻‍💻

![image](https://github.com/user-attachments/assets/3710a373-6095-4ad1-8e24-aa83e7c375f9)

`React-hook-form`을 쓰던 중, ref를 써야할 일이 생겨서 ref를 썼으나 ‘*ref가 두 번 이상 지정되어 이 사용량을 덮어씁니다.’* 라는 에러가 발생했다. `React-hook-form` 에서는 register 내에서 자체적으로 ref 기능을 제공하고 있었기 때문에 ref를 register 밖에 따로 작성하면 발생하는 에러였다. (*참고 : https://react-hook-form.com/docs/useform/register)

![image (1)](https://github.com/user-attachments/assets/e991ee5a-8f8f-4b61-a650-a412cfb18141)

![image (2)](https://github.com/user-attachments/assets/17b3db19-4b21-4f77-a967-1aac89ea8e8a)

ref를 사용하기 위해 register 내에 넣어주었으나, register를 사용하고 있음에도 ‘register를 찾을 수 없다’는 에러가 발생했다. `React-hook-form`을 컴포넌트로 분리하면서 **`useFormContext`** 를 사용했고 이 과정에서 register를 method를 통해 불러오며 발생한 에러였다. (*참고 : https://react-hook-form.com/docs/useformcontext) 

### 문제해결 ✅

![image (3)](https://github.com/user-attachments/assets/0ab84335-7023-489f-bbd5-4cc56a79100a)

```jsx
// 아래 형식으로 쓰던 것을 
const {ref, …rest} = **register**(”recipeDoneImg”) 

// 바꿔서 써줬더니 에러가 해결되었다.
const {ref, …rest} = **methods.register**(”recipeDoneImg”) 
```
</details>

<details>
<summary>React-Hook-Form Watch 함수 사용 🎮</summary>
 
회원가입쪽에서 가입하는 유저의 프로필 이미지를 받을 때 사용자가 이미지를 등록해야만 사진 제거 버튼이 화면에 나오도록 로직을 썼다. 그래서 리액트 훅 폼의 `watch` 함수를 `props`로 넘겨줘서 프로필 이미지 값이 존재하면 사진 제거 버튼이 나오고, 값이 존재하지 않으면 사진 제거 버튼이 나오지 않도록 구현했는데 테스트를 하다 보니 사진을 아직 등록하지 않았는데 사진 제거 버튼이 뜨는 문제가 발생했다.

![image (4)](https://github.com/user-attachments/assets/7f36bee4-14c2-4057-8f3b-bcf9ce9468f8)

그래서 콘솔로 `!!watch(”profileImage”)`를 찍어보았다. 분명 처음 렌더링시에는 `false`로 나오다가 리렌더링이 발생하면 사진을 선택하지 않아도 `true`로 바뀌어버린다. 그래서 `boolean`값이 아닌 `watch(”profileImage”)`를 확인해보니 처음엔 `undefined`였고 

```jsx
FileList {length: 0}length: 0[[Prototype]]: FileList
```

리렌더링시에 이런식으로 객체로 나오게 됐다. 

### 원인분석 👩🏻‍💻

`<input type="file">` 요소가 생성될 때 `FileList` 객체를 초기화하기 때문인데, 빈 상태라도 `FileList` 객체로 초기화되어 리렌더링이 발생할 때 React Hook Form의 `watch` 함수가 이 빈 객체를 감지하게 된다.
기본적으로 `FileList`는 사용자가 파일을 선택하지 않으면 빈 상태로 유지된다. 
하지만 리렌더링 시 `FileList` 객체 자체는 존재하기 때문에 `undefined` 대신 `FileList {length: 0}` 형태로 나타나게 된다.

그래서 undefined이든 객체형태든 사진을 등록하지 않으면 `false`를 전달해주기 위해 `props`로 내려준 코드를 수정했다.

```jsx
isProfileSet={!!watch("profileImage")?.length}
```

![image (5)](https://github.com/user-attachments/assets/51392ea8-0fb8-4752-a16c-83ae3ff7c8dd)
</details>

<details>
<summary>next.config.mjs 프로토콜 설정 문제 🎤</summary>
 
기능 구현 기간동안 전체적인 구조를 완성하고 이미지 최적화를위해 임시로 만들어둔 img태그를 next.js의 Image 컴포넌트로 변경작업을 했다. 변경후 브라우저에서 테스트를 해보기위해 yarn dev 런타임을 했더니 다음과 같은 에러가 발생했다.

![스크린샷 2024-11-05 오전 2 17 40(2)](https://github.com/user-attachments/assets/f31b5dee-397d-40b6-8e8c-9192f6e668e7)

기획후 프로젝트 초기 셋업 할때 api에서 제공하는 이미지 주소를 사전에 확인 했었고 `next.config.mjs` 파일도 필요한 코드를 넣어 준비를 철저하게 했는데 오류가 발생했다.

### 원인 찾기 👩🏻‍💻

- 프로토콜 형식 변경 : 문제 발생에 있는 사진처럼 http 프로토콜 형식이 잘못됐다하여 http에서 https로 변경을 했다. 그런데 반대로 https 프로토콜 형식이 잘못됐다는 오류가 나왔고 다른 문제가 있는지 다시 찾아보기 시작했다.
    
    ![스크린샷 2024-11-06 오후 10 57 10(2)](https://github.com/user-attachments/assets/7c9cd4ab-b148-4ba2-9097-6b612d5f486f)

    
- 테이블 컬럼 확인 : 이 에러가 발생했던 날 supabase 테이블 추가 작업이 있었고 변경도중에 오류가 발생했을것이라 추측하고 확인해봤다. 데이터 테이블을 확인해보니 해당 컬럼에는 사진 형식이 잘 들어가 있었고, 컬럼설정또한 문제가 없었다. 테이블에 있는 데이터를 쭉 살펴보던도중 http사이에 https로 시작하는 이미지가 있었고 api에서 받아온 이미지는 프로토콜이 두가지로 되어있는것을 정확히 알게 되었다. 이결과에 따라 두가지의 프로토콜을 적용시키는 법을 고민해봤다.
    
    ![C107E12C-38E4-4D9E-ADC2-904FB9CCFBDA_4_5005_c](https://github.com/user-attachments/assets/ba01211a-31bf-4b6e-b2da-42615b37bf5f)

    
- 같은 호스트 주소로 프로토콜 이중 적용 : 프로토콜 관련된것은 `next.config.mjs` 파일이 유력해서 다시 파일을 열었다. 이때 두가지의 방법을 시도했었는데, 우선 첫번째 시도는 `next.config.mjs` 파일에 있는 해당 이미지의 주소가 들어있는 객체안을 봤을때 프로토콜 형식이 적혀있는데 한객체 안에서도 적용이 된다는 판단을 가지고 배열을통해 2중으로 만들었다.
    
    ```tsx
    {
      protocol: ["http", "https"],
      hostname: "www.foodsafetykorea.go.kr",
      port: "",
      pathname: "/**"
    },
    
    // vscode 오류 내용
    
    nvalid next.config.mjs options detected: 
    Expected 'http' | 'https', received array at 
    "images.remotePatterns[0].protocol" See more info here: 
    https://nextjs.org/docs/messages/invalid-next-config
    ```
    
    결과는 vscode 에서 에러를 받고 실패했다. 두번째 시도는 객체안에 배열형식은 적용이 되지 않는것 같아 객체를 2개로 만들었을때 어떤 결과가 나오는지 궁금하여 같은 객체를 복사하고 프로토콜 형식만 다르게 적용을 해보았더니 모든 오류가 해결되었다.
    
    ![F6DACB59-4B5B-44C9-B568-D2823766496F_1_201_a](https://github.com/user-attachments/assets/7e961e9f-9e22-4473-81bf-cbb03e200d23)


### 문제 해결 ✅

결과적으로 사진이 가지고 있는 주소가 http와 https 이렇게 두가지 인것을 알게 되었고 두가지 프로토콜 형식을 적용해 보았더니 vscode와 런타임 환경에서 발생했던 오류가 사라져 해결이 되었다.
</details>
